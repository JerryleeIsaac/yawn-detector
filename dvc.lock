schema: '2.0'
stages:
  preprocess:
    cmd: python -m src.pipelines.preprocess --params params.yaml
    deps:
    - path: data/split
      md5: 1daa05ef7dece01c33c30f9af4f2ade0.dir
      size: 1462746813
      nfiles: 481
    - path: src/pipelines/preprocess.py
      md5: 39fe2cd469d1362529c69f17f5fcf4b7
      size: 3452
    params:
      params.yaml:
        preprocess:
          split_dir: data/split
          test_size: 0.3
          face_reco_batch_size: 16
          data_files_dir: pipeline_outs/faces
          train_data_files_dir: pipeline_outs/faces/train
          train_data_files_zip: pipeline_outs/faces/train.zip
          test_data_files_dir: pipeline_outs/faces/test
          test_data_files_zip: pipeline_outs/faces/test.zip
    outs:
    - path: pipeline_outs/faces
      md5: 08af58202fd1b65b592ff81a14406bb0.dir
      size: 2780343961
      nfiles: 2
  train:
    cmd: python -m src.pipelines.train --params params.yaml
    deps:
    - path: pipeline_outs/faces
      md5: 08af58202fd1b65b592ff81a14406bb0.dir
      size: 2780343961
      nfiles: 2
    - path: src/pipelines/train.py
      md5: 224656df5beaea100316a099e3784682
      size: 11311
    params:
      params.yaml:
        train:
          train_data_files_dir: pipeline_outs/faces/train
          train_data_files_zip: pipeline_outs/faces/train.zip
          test_data_files_dir: pipeline_outs/faces/test
          test_data_files_zip: pipeline_outs/faces/test.zip
          model_criterion: CrossEntropy
          model_type: MobileNetV3
          model_params:
            pretrained: true
          optimizer_type: SGD
          optimizer_params:
            momentum: 0.9
            learning_rate: 0.001
          scheduler_type: ReduceLROnPlateau
          scheduler_params:
            step_size: 7
            patience: 7
            gamma: 0.1
            factor: 0.1
          input_size: 128
          epochs: 10
          batch_size: 128
          n_workers: 8
          model_dir: pipeline_outs/models
          model_file: pipeline_outs/models/latest-model.pth
          results_dir: pipeline_outs/results/
          train_results_file: pipeline_outs/results/train-results.json
          train_plots_file: pipeline_outs/results/train-plots.json
          test_results_file: pipeline_outs/results/test-results.json
          test_plots_file: pipeline_outs/results/test-plots.json
          losses_file: pipeline_outs/results/losses.json
    outs:
    - path: pipeline_outs/models/latest-model.pth
      md5: 57b172a1344bc037ca3d443b59baf9d2
      size: 17022737
    - path: pipeline_outs/results/losses.json
      md5: ca8f6f146c9790e7e15c11c9c29d8030
      size: 52944
    - path: pipeline_outs/results/test-plots.json
      md5: c8320a8f0b864d33f5714bb053419f4e
      size: 1228
    - path: pipeline_outs/results/test-results.json
      md5: 8b91da995e93f61a52de1b5587e0d8fa
      size: 121
    - path: pipeline_outs/results/train-plots.json
      md5: 3dbe7d3aec51cdfdcc315e79a7ba3ad6
      size: 1221
    - path: pipeline_outs/results/train-results.json
      md5: 5855a1b3c64337c12f197bc5ed1b21df
      size: 156
